---

# Copyright 2017-present Open Networking Foundation
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# profile_manifests/mcord.yml
# Configures an M-CORD pod

# Profile info located in orchestration/profiles/<cord_use_case>
cord_use_case: mcord

# site configuration
site_name: mysite
site_humanname: MySite
#site_suffix: "{{ site_name }}.opencord.org"
site_suffix: "cord.lab"
deployment_type: MyDeployment

# Feature toggles
use_fabric: True
use_maas: True

# XOS config
xos_tosca_config_templates:
  - vtn-service.yaml
  - fabric-service.yaml
  - management-net.yaml
  - mcord-cavium-services.yml
  - xos-gui-extensions.yml
  - service-graph-constraints.yaml

# GUI Config [new GUI]
gui_project_name: "M-CORD"
gui_background: "cord-bg.jpg" # TODO find mcord image

enabled_gui_extensions: []

# paths defined in manifest/default.xml
xos_services:
  - name: vtn
    path: orchestration/xos_services/vtn-service
    keypair: vsg_rsa
  - name: openstack
    path: orchestration/xos_services/openstack
  - name: onos
    path: orchestration/xos_services/onos-service
    keypair: onos_rsa
  - name: addressmanager
    path: orchestration/xos_services/addressmanager
  - name: fabric
    path: orchestration/xos_services/fabric
  - name: vmme
    path: orchestration/xos_services/vmme
    keypair: mcord_rsa
  - name: vspgwc
    path: orchestration/xos_services/vspgwc
    keypair: mcord_rsa
  - name: vspgwu
    path: orchestration/xos_services/vspgwu
    keypair: mcord_rsa
  - name: vhss
    path: orchestration/xos_services/vhss
    keypair: mcord_rsa
  - name: hssdb
    path: orchestration/xos_services/hss_db
    keypair: mcord_rsa
  - name: internetemulator
    path: orchestration/xos_services/internetemulator
    keypair: mcord_rsa
  - name: sdncontroller
    path: orchestration/xos_services/sdn-controller
    keypair: mcord_rsa
  - name: vepc
    path: orchestration/xos_services/epc-service
    keypair: mcord_rsa
  - name: progran
    path: orchestration/xos_services/progran

# service graph gui constraints
xos_gui_service_graph_constraints: '[
  ["vepc", null, "mcord", null, null],
  [null, null, "progran", null, null],
  ["hssdb", "vhss", "vmme", null, null],
  [null, "vspgwc", "sdncontroller","vspgwu", null],
  [null, null, null, "internetemulator", null]
]'

# For creating the EPC networks in mcord-cavium-services.yml (copied from EPC blueprint)
mcord_networks:
  - name: s11_network
    subnet: 112.0.0.0/24
    permit_all_slices: True
    template: private_template
    owner: vspgwc
  - name: sgi_network
    subnet: 115.0.0.0/24
    permit_all_slices: True
    owner: vspgwu
    template: private_template
  - name: spgw_network
    subnet: 117.0.0.0/24
    permit_all_slices: True
    template: private_template
    owner: vspgwu
  - name: flat_network_s1mme
    subnet: 118.0.0.0/24
    permit_all_slices: True
    template: flat_template
    owner: vmme
  - name: flat_network_s1u
    subnet: 119.0.0.0/24
    permit_all_slices: True
    template: flat_template
    owner: vspgwu
  - name: s6a_network
    subnet: 120.0.0.0/24
    permit_all_slices: True
    template: private_template
    owner: vhss
  - name: db_network
    subnet: 121.0.0.0/24
    permit_all_slices: True
    template: private_template
    owner: vhss
  - name: flat_network_s1mme_p4
    subnet: 122.0.0.0/24
    permit_all_slices: True
    template: flat_template
    owner: vmme


profile_library: "mcord"

# VTN network configuration
management_network_cidr: 172.27.0.0/24
management_network_ip: 172.27.0.1/24
data_plane_ip: 10.168.0.253/24

# Juju config
charm_versions:
  ceilometer: "cs:trusty/ceilometer-17"
  ceilometer-agent: "cs:trusty/ceilometer-agent-13"
  glance: "cs:trusty/glance-28"
  keystone: "cs:trusty/keystone-267"
  mongodb: "cs:trusty/mongodb-33"
  percona-cluster: "cs:trusty/percona-cluster-31"
  nagios: "cs:trusty/nagios-10"
  neutron-api: "cs:~cordteam/trusty/neutron-api-6"
  nova-cloud-controller: "cs:trusty/nova-cloud-controller-64"
  nova-compute: "cs:~cordteam/trusty/nova-compute-4"
  nrpe: "cs:trusty/nrpe-4"
  ntp: "cs:trusty/ntp-14"
  openstack-dashboard: "cs:trusty/openstack-dashboard-19"
  rabbitmq-server: "cs:trusty/rabbitmq-server-42"

head_lxd_list:
  - name: "juju-1"
    service: "juju"
    aliases:
      - "juju"
    ipv4_last_octet: 10

  - name: "ceilometer-1"
    service: "ceilometer"
    aliases:
      - "ceilometer"
    ipv4_last_octet: 20
    forwarded_ports:
      - { ext: 8777, int: 8777 }

  - name: "glance-1"
    service: "glance"
    aliases:
      - "glance"
    ipv4_last_octet: 30
    forwarded_ports:
      - { ext: 9292, int: 9292 }

  - name: "keystone-1"
    service: "keystone"
    aliases:
      - "keystone"
    ipv4_last_octet: 40
    forwarded_ports:
      - { ext: 35357, int: 35357 }
      - { ext: 4990, int: 4990 }
      - { ext: 5000, int: 5000 }

  - name: "percona-cluster-1"
    service: "percona-cluster"
    aliases:
      - "percona-cluster"
    ipv4_last_octet: 50

  - name: "nagios-1"
    service: "nagios"
    aliases:
      - "nagios"
    ipv4_last_octet: 60
    forwarded_ports:
      - { ext: 3128, int: 80 }

  - name: "neutron-api-1"
    service: "neutron-api"
    aliases:
      - "neutron-api"
    ipv4_last_octet: 70
    forwarded_ports:
      - { ext: 9696, int: 9696 }

  - name: "nova-cloud-controller-1"
    service: "nova-cloud-controller"
    aliases:
      - "nova-cloud-controller"
    ipv4_last_octet: 80
    forwarded_ports:
      - { ext: 8774, int: 8774 }

  - name: "openstack-dashboard-1"
    service: "openstack-dashboard"
    aliases:
      - "openstack-dashboard"
    ipv4_last_octet: 90
    forwarded_ports:
      - { ext: 8080, int: 80 }

  - name: "rabbitmq-server-1"
    service: "rabbitmq-server"
    aliases:
      - "rabbitmq-server"
    ipv4_last_octet: 100

  - name: "mongodb-1"
    service: "mongodb"
    aliases:
      - "mongodb"
    ipv4_last_octet: 110

lxd_service_list:
  - ceilometer
  - glance
  - keystone
  - mongodb
  - nagios
  - neutron-api
  - nova-cloud-controller
  - openstack-dashboard
  - percona-cluster
  - rabbitmq-server

standalone_service_list:
  - ntp
  - nrpe
  - ceilometer-agent


service_relations:
  - name: keystone
    relations: [ "percona-cluster", "nrpe", ]

  - name: nova-cloud-controller
    relations: [ "percona-cluster", "rabbitmq-server", "glance", "keystone", "nrpe", ]

  - name: glance
    relations: [ "percona-cluster", "keystone", "nrpe", ]

  - name: neutron-api
    relations: [ "keystone",  "percona-cluster", "rabbitmq-server", "nova-cloud-controller", "nrpe", ]

  - name: openstack-dashboard
    relations: [ "keystone", "nrpe", ]

  - name: nagios
    relations: [ "nrpe", ]

  - name: "percona-cluster:juju-info"
    relations: [ "nrpe:general-info", ]

  - name: rabbitmq-server
    relations: [ "nrpe", ]

  - name: ceilometer
    relations: [ "mongodb", "rabbitmq-server", "nagios", "nrpe", ]

  - name: "ceilometer:identity-service"
    relations: [ "keystone:identity-service", ]

  - name: "ceilometer:ceilometer-service"
    relations: [ "ceilometer-agent:ceilometer-service", ]


compute_relations:
  - name: nova-compute
    relations: [ "ceilometer-agent", "glance", "nova-cloud-controller", "nagios", "nrpe", ]

  - name: "nova-compute:shared-db"
    relations: [ "percona-cluster:shared-db", ]

  - name: "nova-compute:amqp"
    relations: [ "rabbitmq-server:amqp", ]

  - name: ntp
    relations: [ "nova-compute", ]

image_dir: /opt/cord_profile/images # Should change the build to symlink instead of copy images?
xos_images:
  - name: "image-test"
    url: "https://github.com/opencord/platform-install/releases/download/vms/trusty-server-cloudimg-amd64-disk1.img.20170201"
    checksum: "sha256:ebf007ba3ec1043b7cd011fc6668e2a1d1d4c69c41071e8513ab355df7a057cb"

  - name: "image-mme"
    url: "http://www.vicci.org/cord/c3po-mme1-comp.qcow2.20180131"
    checksum: "sha256:f7e3cb27a02e890f65472c79038be68a161c692ad7c48679d09f12ea97b5c024"

  - name: "image-hss"
    url: "http://www.vicci.org/cord/c3po-hss1-comp.qcow2.20180126"
    checksum: "sha256:86ecb5846212547ecd1c3864b3f1a1b150d083026169acb1018e9b7e0ae95784"

  - name: "image-hss-db"
    url: "http://www.vicci.org/cord/c3po-dbn1-comp.qcow2.20180118"
    checksum: "sha256:88d5370451541d5eec55f4d0c281abe4f679a63bcc8eae9cb57e9c1c9e797daa"

  - name: "image-spgwc"
    url: "http://www.vicci.org/cord/ngic-cp1-comp.qcow2.20180118"
    checksum: "sha256:2495706b3066f969013e3312a61be422c8e2e2aab8e6ee35c2bf1ddf04a0ccb7"

  - name: "image-spgwu"
    url: "http://www.vicci.org/cord/ngic-dp1-comp.qcow2.20180118"
    checksum: "sha256:76a538a7f4c92cd1ca71036c51ddfac21b66c59be9700d9e6e11e8e723369ef8"

  - name: "image-internetemulator"
    url: "http://www.vicci.org/cord/vlc-compress.qcow2.20180119"
    checksum: "sha256:5c3a5752f909d053fc65861ad8e31ceeffb6bd986e3ea421f40f89d8fb299029"
